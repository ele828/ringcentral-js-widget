{"version":3,"sources":["containers/ConversationPage/index.js"],"names":["ConversationPage","formatPhone","props","formatNumber","changeDefaultRecipient","changeMatchedNames","getRecipientName","recipient","getMatcherContactList","getMatcherContactNameList","loadConversation","unloadConversation","phoneNumber","extensionNumber","getMatcherContactName","matcherName","name","id","conversationId","loadConversationById","countryCode","areaCode","disableLinks","currentLocale","messages","conversation","onLogConversation","isLoggedContact","recipients","showSpinner","replyToReceivers","sendButtonDisabled","autoLog","dateTimeFormatter","goBack","propTypes","string","isRequired","bool","func","defaultProps","childContextTypes","mapToProps","_","locale","params","conversationLogger","dateTimeFormat","contactMatcher","regionSettings","rateLimiter","connectivityMonitor","enableContactFallback","pushing","ready","allConversations","find","item","isThrottling","connectivity","mapToFunctions","formatDateTime","router","matcherNames","dataMapping","length","map","matcher","phoneNumbers","phoneType","join","redirect","options","logConversation"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport formatNumber from 'ringcentral-integration/lib/formatNumber';\n\nimport ConversationPanel from '../../components/ConversationPanel';\n\nclass ConversationPage extends Component {\n  getChildContext() {\n    return {\n      formatPhone: this.props.formatNumber,\n      changeDefaultRecipient: this.props.changeDefaultRecipient,\n      changeMatchedNames: this.props.changeMatchedNames,\n      getRecipientName: recipient => (this.getRecipientName(recipient)),\n      getMatcherContactList: this.props.getMatcherContactList,\n      getMatcherContactNameList: this.props.getMatcherContactNameList,\n    };\n  }\n\n  componentDidMount() {\n    this.loadConversation();\n  }\n\n  componentWillUnmount() {\n    this.props.unloadConversation();\n  }\n\n  getRecipientName(recipient) {\n    const phoneNumber = recipient.phoneNumber || recipient.extensionNumber;\n    if (phoneNumber && this.props.getMatcherContactName) {\n      const matcherName = this.props.getMatcherContactName(phoneNumber);\n      if (matcherName) {\n        return matcherName;\n      }\n      return this.props.formatNumber(phoneNumber);\n    }\n    if (recipient.name) {\n      return recipient.name;\n    }\n    return this.props.formatNumber(phoneNumber);\n  }\n\n  loadConversation() {\n    const id = this.props.conversationId;\n    this.props.loadConversationById(id);\n  }\n\n  render() {\n    return (\n      <ConversationPanel\n        countryCode={this.props.countryCode}\n        areaCode={this.props.areaCode}\n        disableLinks={this.props.disableLinks}\n        conversationId={this.props.conversationId}\n        currentLocale={this.props.currentLocale}\n        messages={this.props.messages}\n        conversation={this.props.conversation}\n        onLogConversation={this.props.onLogConversation}\n        isLoggedContact={this.props.isLoggedContact}\n        recipients={this.props.recipients}\n        showSpinner={this.props.showSpinner}\n        replyToReceivers={this.props.replyToReceivers}\n        sendButtonDisabled={this.props.sendButtonDisabled}\n        autoLog={this.props.autoLog}\n        dateTimeFormatter={this.props.dateTimeFormatter}\n        goBack={this.props.goBack}\n      />\n    );\n  }\n}\n\nConversationPage.propTypes = {\n  conversationId: PropTypes.string.isRequired,\n  currentLocale: PropTypes.string.isRequired,\n  sendButtonDisabled: PropTypes.bool.isRequired,\n  showSpinner: PropTypes.bool.isRequired,\n  messages: ConversationPanel.propTypes.messages,\n  recipients: ConversationPanel.propTypes.recipients,\n  replyToReceivers: PropTypes.func.isRequired,\n  unloadConversation: PropTypes.func.isRequired,\n  loadConversationById: PropTypes.func.isRequired,\n  changeDefaultRecipient: PropTypes.func.isRequired,\n  formatNumber: PropTypes.func.isRequired,\n  getMatcherContactName: PropTypes.func,\n  getMatcherContactList: PropTypes.func,\n  getMatcherContactNameList: PropTypes.func,\n  changeMatchedNames: PropTypes.func.isRequired,\n  dateTimeFormatter: PropTypes.func.isRequired,\n};\n\nConversationPage.defaultProps = {\n  getMatcherContactName: null,\n  getMatcherContactList: () => [],\n  getMatcherContactNameList: () => [],\n};\n\nConversationPage.childContextTypes = {\n  formatPhone: PropTypes.func.isRequired,\n  getRecipientName: PropTypes.func.isRequired,\n  changeDefaultRecipient: PropTypes.func.isRequired,\n  changeMatchedNames: PropTypes.func.isRequired,\n  getMatcherContactList: PropTypes.func.isRequired,\n  getMatcherContactNameList: PropTypes.func.isRequired,\n};\n\nfunction mapToProps(_, {\n  locale,\n  params,\n  conversation,\n  conversationLogger,\n  dateTimeFormat,\n  contactMatcher,\n  regionSettings,\n  messages,\n  rateLimiter,\n  connectivityMonitor,\n  enableContactFallback = false,\n}) {\n  return ({\n    enableContactFallback,\n    currentLocale: locale.currentLocale,\n    conversationId: params.conversationId,\n    sendButtonDisabled: conversation.pushing,\n    areaCode: regionSettings.areaCode,\n    countryCode: regionSettings.countryCode,\n    showSpinner: !(\n      dateTimeFormat.ready &&\n      (!contactMatcher || contactMatcher.ready) &&\n      conversation.ready &&\n      regionSettings.ready &&\n      messages.ready &&\n      rateLimiter.ready &&\n      connectivityMonitor.ready &&\n      (!conversationLogger || conversationLogger.ready)\n    ),\n    recipients: conversation.recipients,\n    messages: conversation.messages,\n    conversation: messages.allConversations.find(item => (\n      item.conversationId === params.conversationId\n    )),\n    disableLinks: (\n      rateLimiter.isThrottling ||\n      !connectivityMonitor.connectivity\n    ),\n    autoLog: !!(conversationLogger && conversationLogger.autoLog),\n  });\n}\n\nfunction mapToFunctions(_, {\n  contactMatcher,\n  conversation,\n  dateTimeFormat,\n  dateTimeFormatter = (...args) => dateTimeFormat.formatDateTime(...args),\n  regionSettings,\n  isLoggedContact,\n  conversationLogger,\n  onLogConversation,\n  router,\n}) {\n  let getMatcherContactName;\n  let getMatcherContactList;\n  let getMatcherContactNameList;\n  if (contactMatcher && contactMatcher.ready) {\n    getMatcherContactList = (phoneNumber) => {\n      const matcherNames = contactMatcher.dataMapping[phoneNumber];\n      if (matcherNames && matcherNames.length > 0) {\n        return matcherNames.map(matcher =>\n          `${matcher.name} | ${matcher.phoneNumbers[0].phoneType}`\n        );\n      }\n      return [];\n    };\n    getMatcherContactNameList = (phoneNumber) => {\n      const matcherNames = contactMatcher.dataMapping[phoneNumber];\n      if (matcherNames && matcherNames.length > 0) {\n        return matcherNames.map(matcher => matcher.name);\n      }\n      return [];\n    };\n    getMatcherContactName = (phoneNumber) => {\n      const matcherNames = getMatcherContactNameList(phoneNumber);\n      if (matcherNames && matcherNames.length > 0) {\n        return matcherNames.join('&');\n      }\n      return null;\n    };\n  }\n\n  return {\n    replyToReceivers: (...args) => conversation.replyToReceivers(...args),\n    changeDefaultRecipient: (...args) => conversation.changeDefaultRecipient(...args),\n    changeMatchedNames: (...args) => conversation.changeMatchedNames(...args),\n    unloadConversation: () => conversation.unloadConversation(),\n    loadConversationById: id => conversation.loadConversationById(id),\n    dateTimeFormatter,\n    formatNumber: phoneNumber => formatNumber({\n      phoneNumber,\n      areaCode: regionSettings.areaCode,\n      countryCode: regionSettings.countryCode,\n    }),\n    getMatcherContactName,\n    getMatcherContactList,\n    getMatcherContactNameList,\n    isLoggedContact,\n    onLogConversation: onLogConversation ||\n    (conversationLogger && (async ({ redirect = true, ...options }) => {\n      await conversationLogger.logConversation({\n        ...options,\n        redirect,\n      });\n    })),\n    goBack: () => {\n      router.goBack();\n    },\n  };\n}\n\nexport default connect(\n  mapToProps,\n  mapToFunctions,\n)(ConversationPage);\n"]}